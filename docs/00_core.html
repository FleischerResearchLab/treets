<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Process collected data from mcc app.">

<title>treets - Time Restricted Eating ExperimenTS API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="treets - Time Restricted Eating ExperimenTS API">
<meta property="og:description" content="Process collected data from mcc app.">
<meta property="og:site-name" content="treets">
<meta name="twitter:title" content="treets - Time Restricted Eating ExperimenTS API">
<meta name="twitter:description" content="Process collected data from mcc app.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">treets</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/QiwenZz/treets/tree/master/"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Time Restricted Eating ExperimenTS API</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">TREETS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_core.html" class="sidebar-item-text sidebar-link active">Time Restricted Eating ExperimenTS API</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#utils" id="toc-utils" class="nav-link active" data-scroll-target="#utils">utils</a></li>
  <li><a href="#experiment-design" id="toc-experiment-design" class="nav-link" data-scroll-target="#experiment-design">experiment design</a></li>
  <li><a href="#data-analysissummary" id="toc-data-analysissummary" class="nav-link" data-scroll-target="#data-analysissummary">data analysis/summary</a></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">plots</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/QiwenZz/treets/tree/master/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Time Restricted Eating ExperimenTS API</h1>
</div>

<div>
  <div class="description">
    Process collected data from mcc app.
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default_exp core</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hide</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev.showdoc <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ModuleNotFoundError: No module named 'nbdev'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'words'</span>, quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'stopwords'</span>, quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'wordnet'</span>, quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'punkt'</span>, quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem <span class="im">import</span> WordNetLemmatizer</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords, words</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pkg_resources</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="utils" class="level3">
<h3 class="anchored" data-anchor-id="utils">utils</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> file_loader(data_source):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a helper function that 1. if data_scource is a single file path in pickle/csv format, it reads it into a pd dataframe. 2. if it is a folder path, it reads csv and pickle files that match the pattern parameter in the data_scource folder into one dataframe. </span><span class="ch">\n</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_source(str, pandas df): input path, csv or pickle file or a pattern to be matched when searching csv/pickle files that will be read into one dataframe.</span><span class="ch">\n</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - a pandas dataframe.</span><span class="ch">\n</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(data_source, <span class="bu">str</span>):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        data_lst <span class="op">=</span> glob.glob(data_source)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        dfs <span class="op">=</span> []</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> data_lst:</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> x[<span class="op">-</span><span class="dv">4</span>:] <span class="op">==</span> <span class="st">'.csv'</span>:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                dfs.append(pd.read_csv(x))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> x[<span class="op">-</span><span class="dv">7</span>:] <span class="op">==</span> <span class="st">'.pickle'</span>:</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                pickle_file <span class="op">=</span> <span class="bu">open</span>(x, <span class="st">'rb'</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                pickle_file <span class="op">=</span> pickle.load(pickle_file)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(pickle_file, pd.DataFrame):</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> pickle_file</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                dfs.append(pickle_file)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.concat(dfs).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> data_source</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This reads a specific csv file into a pd dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>file_loader(<span class="st">"data/col_test_data/toy_data_2000.csv"</span>).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This reads in all files that matches yrt*_food_data*.csv pattern in data/col_test_data folder</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>file_loader(<span class="st">'data/col_test_data/yrt*_food_data*.csv'</span>).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This reads all pickle and csv files in ./data/output folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>file_loader(<span class="st">'data/output/*'</span>).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_date(data_source, col, h<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Extract date information from a column and shift each date in the column by h hours. (Day starts h hours early if h is negative and h hours late if h is positive)</span><span class="ch">\n</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource(str, pandas df): input path, file in pickle, csv or pandas dataframe format</span><span class="ch">\n</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - col(str) : column that contains the information of date and time, which is 24 hours system.</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - h(int) : hours to shift the date. For example, when h = 4, everyday starts and ends 4 hours later than normal.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - a pandas series represents the date extracted from col.</span><span class="ch">\n</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Elements in col should be pd.datetime objects</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_source)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[col].dtype <span class="op">==</span> <span class="st">'O'</span>:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"'</span><span class="sc">{}</span><span class="st">' column must be converted to datetime object"</span>.<span class="bu">format</span>(col))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_date(d, h):</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> d.hour <span class="op">&lt;</span> h:</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> d.date() <span class="op">-</span> pd.Timedelta(<span class="st">'1 day'</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> d.hour<span class="op">+</span><span class="dv">1</span> <span class="op">&gt;</span> (<span class="dv">24</span><span class="op">+</span>h):</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> d.date() <span class="op">+</span> pd.Timedelta(<span class="st">'1 day'</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d.date()</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[col].<span class="bu">apply</span>(find_date, args<span class="op">=</span>([h]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> file_loader(<span class="st">'data/test_food_details.csv'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'original_logtime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'original_logtime'</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>, <span class="st">'date'</span>]].head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>, <span class="st">'date'</span>]].head(<span class="dv">3</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># last two rows shift one day earlier due to that a day starts at 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>, <span class="st">'date'</span>]].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>note that last two rows shift one day later due to that a day ends at 20</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_float_time(data_scource, col, h<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Extract time information from a column and shift each time by h hours. (Day starts h hours early if h is negative and h hours late if h is positive)</span><span class="ch">\n</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or pandas dataframe format</span><span class="ch">\n</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - col(str) : column that contains the information of date and time that's 24 hours system.</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - h(int) : hours to shift the date. For example, when h = 4, everyday starts at 4 and ends at 28. When h = -4, everyday starts at -4 and ends at 20.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - a pandas series represents the date extracted from col.</span><span class="ch">\n</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Elements in col should be pd.datetime objects</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[col].dtype <span class="op">==</span> <span class="st">'O'</span>:</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"'</span><span class="sc">{}</span><span class="st">' column must be converted to datetime object firsly"</span>.<span class="bu">format</span>(col))</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    local_time <span class="op">=</span> df[col].<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Timedelta(x.time().isoformat()).total_seconds() <span class="op">/</span><span class="fl">3600.</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> h <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        local_time <span class="op">=</span> np.where(local_time <span class="op">&lt;</span> h, <span class="dv">24</span><span class="op">+</span> local_time, local_time)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(local_time)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> h <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        local_time <span class="op">=</span> np.where(local_time <span class="op">&gt;</span> (<span class="dv">24</span><span class="op">+</span>h), local_time<span class="op">-</span><span class="fl">24.</span>, local_time)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(local_time)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> local_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> file_loader(<span class="st">'data/test_food_details.csv'</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'original_logtime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'original_logtime'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'float_time'</span>] <span class="op">=</span> find_float_time(df, <span class="st">'original_logtime'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>, <span class="st">'float_time'</span>]].head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'float_time'</span>] <span class="op">=</span> find_float_time(df, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>,<span class="st">'date'</span>, <span class="st">'float_time'</span>]].head(<span class="dv">3</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># last two rows shift one day earlier due to that a day starts at 4 and ends at 28</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'float_time'</span>] <span class="op">=</span> find_float_time(df, <span class="st">'original_logtime'</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'original_logtime'</span>,<span class="st">'date'</span>, <span class="st">'float_time'</span>]].head(<span class="dv">5</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># last two rows shift one day later and local_time starts at -4 and ends at 20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> week_from_start(data_scource, col, identifier):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">        Description:</span><span class="ch">\n</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">            Calculate the number of weeks for each logging since the first day of the logging for each participant(identifier). The returned values for loggings from the first week are 1. </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Input:</span><span class="ch">\n</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">            - data_scource (str, pandas df): input path, file in pickle, csv or pandas dataframe format</span><span class="ch">\n</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">            - col (str): column name that contains date information from the data_scource dataframe.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">            - identifier (str): unique_id or ID, or name that identifies people.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Return:</span><span class="ch">\n</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">            - a numpy array represents the date extracted from col.</span><span class="ch">\n</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'date'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">NameError</span>(<span class="st">"There must exist a 'date' column."</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle week from start</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        df_dic <span class="op">=</span> <span class="bu">dict</span>(df.groupby(identifier).agg(np.<span class="bu">min</span>)[col])</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_week_public(s):</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (s.date <span class="op">-</span> df_dic[s[identifier]]).days <span class="op">//</span> <span class="dv">7</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df.<span class="bu">apply</span>(count_week_public, axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> file_loader(<span class="st">'data/test_food_details.csv'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'original_logtime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'original_logtime'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date column is a pre-requisite</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> find_date(df, <span class="st">'original_logtime'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'week_from_start'</span>] <span class="op">=</span> week_from_start(df, <span class="st">'date'</span>, <span class="st">'unique_code'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'unique_code'</span>,<span class="st">'original_logtime'</span>,<span class="st">'week_from_start'</span>]][<span class="dv">2</span>:<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_phase_duration(df):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a function that calculates how many days each phase in the study took. Result includes the start and end date for that phase.</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : information dataframe that contains columns: Start_Day, End_day</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - a dataframe contains the phase_duration column.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'Start_day' and 'End_day' column exist in the df.</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'phase_duration' column exists in the df.</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'phase_duration'</span>] <span class="op">=</span> df[<span class="st">'End_day'</span>] <span class="op">-</span> df[<span class="st">'Start_Day'</span>]<span class="op">+</span> pd.Timedelta(<span class="st">"1 days"</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>find_phase_duration(pd.read_excel(<span class="st">'data/col_test_data/toy_data_17May2021.xlsx'</span>))[[<span class="st">'phase_duration'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_public_data(data_scource, identifier, datetime_col, h):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Load original public data and output processed data in a dataframe.</span><span class="ch">\n</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">        Process includes:</span><span class="ch">\n</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">        1. Dropping 'foodimage_file_name' column.</span><span class="ch">\n</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">        2. Handling the format of time by deleting am/pm by generating a new column, 'original_logtime_notz'</span><span class="ch">\n</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">        3. Generating the date column with possible hour shifts, 'date'</span><span class="ch">\n</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">        4. Converting time into float number into a new column with possible hour shifts, 'float_time'</span><span class="ch">\n</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">        5. Converting time to a format of HH:MM:SS, 'time'</span><span class="ch">\n</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">        6. Generating the column 'week_from_start' that contains the week number that the participants input the food item.</span><span class="ch">\n</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">        7. Generating 'year' column based on the input data.</span><span class="ch">\n</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str or pandas df): input path, csv file</span><span class="ch">\n</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - identifier(str): id-like column that's used to identify a subject.</span><span class="ch">\n</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - datetime_col(str): column that contains date and time in string format.</span><span class="ch">\n</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - h(int) : hours to shift the date. For example, when h = 4, everyday starts and ends 4 hours later than normal.</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - the processed dataframe in pandas df format.</span><span class="ch">\n</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">            - foodimage_file_name</span><span class="ch">\n</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">            - original_logtime</span><span class="ch">\n</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">            - date</span><span class="ch">\n</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">            - unique_code</span><span class="ch">\n</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    public_all <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        public_all <span class="op">=</span> public_all.drop(columns <span class="op">=</span> [<span class="st">'foodimage_file_name'</span>])</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_public_time(s):</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co">        helper function to get rid of am/pm in the end of each time string</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        tmp_s <span class="op">=</span> s.replace(<span class="st">'p.m.'</span>, <span class="st">''</span>).replace(<span class="st">'a.m.'</span>, <span class="st">''</span>)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pd.to_datetime(<span class="st">' '</span>.join(tmp_s.split()[:<span class="dv">2</span>]) )</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">int</span>(tmp_s.split()[<span class="dv">1</span>][:<span class="dv">2</span>]) <span class="op">&gt;</span> <span class="dv">12</span>:</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>                    tmp_s <span class="op">=</span> s.replace(<span class="st">'p.m.'</span>, <span class="st">''</span>).replace(<span class="st">'a.m.'</span>, <span class="st">''</span>).replace(<span class="st">'PM'</span>, <span class="st">''</span>).replace(<span class="st">'pm'</span>, <span class="st">''</span>)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> pd.to_datetime(<span class="st">' '</span>.join(tmp_s.split()[:<span class="dv">2</span>]) )</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> np.nan</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    public_all[datetime_col] <span class="op">=</span> public_all[datetime_col].<span class="bu">apply</span>(handle_public_time)</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>    public_all <span class="op">=</span> public_all.dropna().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    public_all[<span class="st">'date'</span>] <span class="op">=</span> find_date(public_all, datetime_col, h)</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle the time - Time in floating point format</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>    public_all[<span class="st">'float_time'</span>] <span class="op">=</span> find_float_time(public_all, datetime_col, h)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle the time - Time in Datetime object format</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    public_all[<span class="st">'time'</span>] <span class="op">=</span> pd.DatetimeIndex(public_all[datetime_col]).time</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle week from start</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    public_all[<span class="st">'week_from_start'</span>] <span class="op">=</span> week_from_start(public_all,<span class="st">'date'</span>,identifier)</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>    public_all[<span class="st">'year'</span>] <span class="op">=</span> public_all.date.<span class="bu">apply</span>(<span class="kw">lambda</span> d: d.year)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> public_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, h<span class="op">=</span><span class="dv">4</span>).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_good_logging_day(data_scource, identifier, date_col, time_col, min_log_num <span class="op">=</span> <span class="dv">2</span>, min_seperation <span class="op">=</span> <span class="dv">4</span>):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">        A logging's in a good logging day if the there are more than min_log_num loggings in one day w/ more than min_seperation hoursx apart from the earliest logging and the latest logging and False otherwise.</span><span class="ch">\n</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or pandas dataframe format.</span><span class="ch">\n</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identifier (str): id-like column that's used to identify a subject.</span><span class="ch">\n</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col (str): column that contains time in float format.</span><span class="ch">\n</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span><span class="ch">\n</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span><span class="ch">\n</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - A boolean numpy array indicating whether the corresponding row is in a good logging day. Details on the criteria is in the description.</span><span class="ch">\n</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> adherent(s):</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(s.values) <span class="op">&gt;=</span> min_log_num <span class="kw">and</span> (<span class="bu">max</span>(s.values) <span class="op">-</span> <span class="bu">min</span>(s.values)) <span class="op">&gt;=</span> min_seperation:</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    adherent_dict <span class="op">=</span> <span class="bu">dict</span>(df.groupby([identifier, date_col])[time_col].agg(adherent))</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: adherent_dict[(x[identifier], x.date)], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>,<span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, <span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_loggings(data_scource, text_col, identifier):</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function convert all the loggings in the data_scource file into a list of typo-corrected items based on the text_col column. This function is based on a built-in vocabulary dictionary and an n-gram searcher.</span><span class="ch">\n</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">       </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - text_col(str): column that will be converted to individual items.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identifier(str): participants' unique identifier such as id, name, etc.</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - A dataframe contains the cleaned version of the text_col.</span><span class="ch">\n</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    public_all <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize food parser instance</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> FoodParser()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    fp.initialization()</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># parse food</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    parsed <span class="op">=</span> [fp.parse_food(i, return_sentence_tag <span class="op">=</span> <span class="va">True</span>) <span class="cf">for</span> i <span class="kw">in</span> public_all.desc_text.values]</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    public_all_parsed <span class="op">=</span> pd.DataFrame({</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    identifier: public_all[identifier],</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    text_col: public_all[text_col],</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cleaned'</span>: parsed</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    public_all_parsed[<span class="st">'cleaned'</span>] <span class="op">=</span> public_all_parsed[<span class="st">'cleaned'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>])</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> public_all_parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>clean_loggings(<span class="st">'data/output/public.pickle'</span>, <span class="st">'desc_text'</span>, <span class="st">'unique_code'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_types(data_scource, food_type):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function filters with the expected food types and return a cleaner version of data_scource file.</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">       </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span><span class="ch">\n</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - food_type (str): expected types of the loggings for filtering, in format of list. Available types:  </span><span class="ch">\n</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">            1. 'w' : water </span><span class="ch">\n</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">            2. 'b' : beverage </span><span class="ch">\n</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">            3. 'f' : food </span><span class="ch">\n</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">            4. 'm' : medicine </span><span class="ch">\n</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - A filtered dataframe with expected food type/types with five columns: 'unique_code','food_type', 'desc_text', 'date', 'local_time'.</span><span class="ch">\n</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(food_type) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(food_type) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> food_type[<span class="dv">0</span>] <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'w'</span>, <span class="st">'b'</span>, <span class="st">'f'</span>, <span class="st">'m'</span>]:</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"not a valid logging type"</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>        filtered <span class="op">=</span> df[df[<span class="st">'food_type'</span>]<span class="op">==</span>food_type[<span class="dv">0</span>]]</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        filtered <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin(food_type)]</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filtered</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>get_types(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,[<span class="st">'w'</span>, <span class="st">'f'</span>])[[<span class="st">'unique_code'</span>,<span class="st">'desc_text'</span>,<span class="st">'food_type'</span>]].head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>get_types(df, [<span class="st">'m'</span>])[[<span class="st">'unique_code'</span>,<span class="st">'desc_text'</span>,<span class="st">'food_type'</span>]].head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_caloric_entries(df):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a function that counts the number of food and beverage loggings.</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - a float representing the number of caloric entries.</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'food_type'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"'food_type' column must exist in the dataframe."</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>count_caloric_entries(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_daily_eating_duration(df, date_col, time_col):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a function that calculates the mean daily eating window, which is defined as the duration of first and last caloric intake.</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains the float time data for each logging.</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - a float representing the mean daily eating window.</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - float time is calculated.</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])]</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    breakfast_time <span class="op">=</span> df.groupby(date_col).agg(<span class="bu">min</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    dinner_time <span class="op">=</span> df.groupby(date_col).agg(<span class="bu">max</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (dinner_time[time_col]<span class="op">-</span>breakfast_time[time_col]).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mean_daily_eating_duration(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> std_daily_eating_duration(df, date_col, time_col):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the standard deviation of daily eating window, which is defined as the duration between the first and last caloric intake.</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains the float time data for each logging.</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - a float representing the standard deviation of daily eating window.</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'food_type' column existed in the df.</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])]</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    breakfast_time <span class="op">=</span> df.groupby(date_col).agg(<span class="bu">min</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    dinner_time <span class="op">=</span> df.groupby(date_col).agg(<span class="bu">max</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (dinner_time[time_col]<span class="op">-</span>breakfast_time[time_col]).std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>std_daily_eating_duration(df, <span class="st">'date'</span>, <span class="st">'float_time'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> earliest_entry(df, date_col, time_col):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the earliest first calorie on any day in the study period. </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains information of logging time in float.</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - the earliest caloric time in float on any day in the study period. </span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> get_types(df, [<span class="st">'f'</span>, <span class="st">'b'</span>])</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[time_col].<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>earliest_entry(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_first_cal(df, date_col, time_col):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the average time of first calory intake. </span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains information of logging time in float.</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - the mean first caloric intake time in float in the study period. </span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.groupby([date_col])[time_col].<span class="bu">min</span>().mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>mean_first_cal(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the average mean first cal time for each participant</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'unique_code'</span>).agg(mean_first_cal, <span class="st">'date'</span>, <span class="st">'float_time'</span>).iloc[:,<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> std_first_cal(df, date_col, time_col):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the average time of first calory intake. </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains information of logging time in float.</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - the mean first caloric intake time in float in the study period. </span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.groupby([date_col])[time_col].<span class="bu">min</span>().std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>std_first_cal(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_last_cal(df, date_col, time_col):</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the average time of last calory intake. </span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains information of logging time in float.</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - the mean last caloric intake time in float in the study period. </span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.groupby([date_col])[time_col].<span class="bu">max</span>().mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mean_last_cal(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> std_last_cal(df, date_col, time_col):</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the average time of last calory intake. </span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(column existed in df, string) : column name that contains date information from the df dataframe.</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(column existed in df, string) : contains information of logging time in float.</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - the mean last caloric intake time in float in the study period. </span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.groupby([date_col])[time_col].<span class="bu">max</span>().std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>std_last_cal(df, <span class="st">'date'</span>, <span class="st">'float_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logging_day_counts(df):</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the number of days that contains any loggings. </span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df) : food_logging data.</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - an integer that represents the number of logging days.</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.date.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>logging_day_counts(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_missing_logging_days(df, start_date<span class="op">=</span><span class="st">'not_defined'</span>, end_date<span class="op">=</span><span class="st">'not_defined'</span>):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function finds the days during which there's no logging within the period from start_date to end_date. </span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(panda df): food_logging data.</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - start_date(datetime.date object): start date of the period of calculation. If not defined, it will be automatically set to be the earliest date in df. </span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - end_date(datetime.date object): end date of the period of calculation. If not defined, it will be automatically set to be the latest date in df.</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - a list that contains all of the dates that don't contain loggings.</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if start_date or end_date is missing, return nan</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isnull(start_date) <span class="kw">or</span> pd.isnull(end_date):</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if there is no input on start_date or end_date, use earliest date and latest date</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start_date<span class="op">==</span><span class="st">'not_defined'</span>:</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        start_date <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">min</span>()</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> end_date<span class="op">==</span><span class="st">'not_defined'</span>:</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>        end_date <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">max</span>()</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[(df[<span class="st">'date'</span>]<span class="op">&gt;=</span>start_date) <span class="op">&amp;</span> (df[<span class="st">'date'</span>]<span class="op">&lt;=</span>end_date)]</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get all the dates between two dates</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> []</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> pd.date_range(start_date, end_date, freq<span class="op">=</span><span class="st">'d'</span>):</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> df[<span class="st">'date'</span>].unique():</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>                lst.append(x.date())</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>find_missing_logging_days(df, datetime.date(<span class="dv">2017</span>, <span class="dv">12</span>, <span class="dv">7</span>), datetime.date(<span class="dv">2017</span>, <span class="dv">12</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> good_lwa_day_counts(df, window_start, window_end, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_seperation<span class="op">=</span><span class="dv">5</span>, buffer_time<span class="op">=</span> <span class="st">'15 minutes'</span>,h<span class="op">=</span><span class="dv">4</span>, start_date<span class="op">=</span><span class="st">'not_defined'</span>, end_date<span class="op">=</span><span class="st">'not_defined'</span>):</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function calculates the number of good logging days, good window days, outside window days and adherent days. Good logging day is defined as a day that the person makes at least min_log_num number of loggings and the time separation between the earliest and the latest logging are greater than min_seperation.</span><span class="ch">\n</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">        A good window day is defined as a date that all the food loggings are within the assigned restricted window. An adherent day is defined as a date that is both a good logging day and a good window day.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - df(pandas df): food_logging data.</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - window_start(datetime.time object): start time of the restriction window.</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - window_end(datetime.time object): end time of the restriction window.</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the eating time.</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num(count, int): minimum number of loggings to qualify a day as a good logging day</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours, int): minimum period of separation between earliest and latest loggings to qualify a day as a good logging day</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - buffer_time(time in string that can be passed into pd.Timedelta()): wiggle room for to be added/subtracted on the ends of windows.</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - h(hours, int): hours to be pushed back</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - start_date(datetime.date object): start date of the period for calculation. If not defined, it will be automatically set to be the earliest date in df.</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - end_date(datetime.date object): end date of the period for calculation. If not defined, it will be automatically set to be the latest date in df.</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - Two lists.</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co">            - First list contains 4 integers that represent the number of good logging days, good window days, outside window days and adherent_days</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co">            - Second list contains lists consisted of specific dates that are not good logging days, window days and adherent days within the range of start date and end date(both inclusive).</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - 'date' column existed in the df.</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="co">        - float time is calculated as time_col.</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if start_date or end_date is missing, return nan</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isnull(start_date) <span class="kw">or</span> pd.isnull(end_date):</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [np.nan,np.nan,np.nan,np.nan], [[],[],[]]</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if window start or window end are nan, make the windows the same as control's window time.</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isnull(window_start):</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>        window_start <span class="op">=</span> datetime.time(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isnull(window_end):</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>        window_end <span class="op">=</span> datetime.time(<span class="dv">23</span>,<span class="dv">59</span>)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if there is no input on start_date or end_date, use earliest date and latest date</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start_date<span class="op">==</span><span class="st">'not_defined'</span>:</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        start_date <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">min</span>()</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> end_date<span class="op">==</span><span class="st">'not_defined'</span>:</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>        end_date <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">max</span>()</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># helper function to determine a good logging</span></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> good_logging(local_time_series):</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(local_time_series.values) <span class="op">&gt;=</span> min_log_num <span class="kw">and</span> (<span class="bu">max</span>(local_time_series.values) <span class="op">-</span> <span class="bu">min</span>(local_time_series.values)) <span class="op">&gt;=</span> min_seperation:</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[(df[<span class="st">'date'</span>]<span class="op">&gt;=</span>start_date) <span class="op">&amp;</span> (df[<span class="st">'date'</span>]<span class="op">&lt;=</span>end_date)]</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])]</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'original_logtime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'original_logtime'</span>]).dt.tz_localize(<span class="va">None</span>)</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>    buffer_time <span class="op">=</span> pd.Timedelta(buffer_time).total_seconds()<span class="op">/</span><span class="fl">3600.</span></span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>    in_window_count <span class="op">=</span> []</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>    daily_count <span class="op">=</span> []</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>    good_logging_count <span class="op">=</span> []</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>    cur_dates <span class="op">=</span> df[<span class="st">'date'</span>].sort_values(ascending <span class="op">=</span> <span class="va">True</span>).unique()</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> aday <span class="kw">in</span> cur_dates:</span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>        window_start_daily <span class="op">=</span> window_start.hour<span class="op">+</span>window_start.minute<span class="op">/</span><span class="dv">60</span><span class="op">-</span> buffer_time</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a>        window_end_daily <span class="op">=</span> window_end.hour<span class="op">+</span>window_end.minute<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> buffer_time</span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> df[df[<span class="st">'date'</span>]<span class="op">==</span>aday]</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (window_start <span class="op">==</span> datetime.time(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="kw">and</span> (window_end <span class="op">==</span> datetime.time(<span class="dv">23</span>,<span class="dv">59</span>)):</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>            in_window_count.append(tmp[(tmp[time_col]<span class="op">&gt;=</span>window_start_daily<span class="op">+</span>h) <span class="op">&amp;</span> (tmp[time_col]<span class="op">&lt;=</span>window_end_daily<span class="op">+</span>h)].shape[<span class="dv">0</span>])</span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a>            in_window_count.append(tmp[(tmp[time_col]<span class="op">&gt;=</span>window_start_daily) <span class="op">&amp;</span> (tmp[time_col]<span class="op">&lt;=</span>window_end_daily)].shape[<span class="dv">0</span>])</span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a>        daily_count.append(df[df[<span class="st">'date'</span>]<span class="op">==</span>aday].shape[<span class="dv">0</span>])</span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a>        good_logging_count.append(good_logging(df[df[<span class="st">'date'</span>]<span class="op">==</span>aday][time_col]))</span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a>    in_window_count <span class="op">=</span> np.array(in_window_count)</span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a>    daily_count <span class="op">=</span> np.array(daily_count)</span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a>    good_logging_count <span class="op">=</span> np.array(good_logging_count)</span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a>    good_logging_by_date <span class="op">=</span> [cur_dates[i] <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(good_logging_count) <span class="cf">if</span> x <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a>    good_window_days <span class="op">=</span> (in_window_count<span class="op">==</span>daily_count)</span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a>    good_window_day_counts <span class="op">=</span> good_window_days.<span class="bu">sum</span>()</span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a>    good_window_by_date <span class="op">=</span> [cur_dates[i] <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(good_window_days) <span class="cf">if</span> x <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a>    outside_window_days <span class="op">=</span> in_window_count.size <span class="op">-</span> good_window_days.<span class="bu">sum</span>()</span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a>    good_logging_days <span class="op">=</span> good_logging_count.<span class="bu">sum</span>()</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> good_logging_count.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a>        adherent_day_counts <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a>        adherent_days_by_date <span class="op">=</span> []</span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a>        adherent_days <span class="op">=</span> (good_logging_count <span class="op">&amp;</span> (in_window_count<span class="op">==</span>daily_count))</span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a>        adherent_days_by_date <span class="op">=</span> [cur_dates[i] <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(adherent_days) <span class="cf">if</span> x <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a>        adherent_day_counts <span class="op">=</span> adherent_days.<span class="bu">sum</span>()</span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> [good_logging_days, good_window_day_counts, outside_window_days, adherent_day_counts]</span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a>    bad_dates <span class="op">=</span> [good_logging_by_date, good_window_by_date, adherent_days_by_date]</span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows, bad_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>,<span class="dv">4</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dates, bad_dates <span class="op">=</span> good_lwa_day_counts(df, datetime.time(<span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">0</span>), datetime.time(<span class="dv">23</span>,<span class="dv">59</span>,<span class="dv">59</span>), <span class="st">'float_time'</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>bad_dates[<span class="dv">0</span>][:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="experiment-design" class="level3">
<h3 class="anchored" data-anchor-id="experiment-design">experiment design</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filtering_usable_data(df, identifier, date_col, num_items, num_days):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function filters the cleaned app data so the users who satisfies the criteria are left. The criteria is that the person is left if the total loggings for that person are more than num_items and at the same time, the total days of loggings are more than num_days.</span><span class="ch">\n</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">        - df (pd.DataFrame): the dataframe to be filtered</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - identifier (str): unique_id or ID, or name that identifies people.</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col (str): column name that contains date information from the df dataframe.</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - num_items (int):   number of items to be used as cut-off</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - num_days (int):    number of days to be used as cut-off</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - df_usable:  a panda DataFrame with filtered rows</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - set_usable: a set of unique_code to be included as "usable"</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co">        df should have the following columns:</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co">            - desc_text</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">' =&gt; filtering_usable_data()'</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'  =&gt; using the following criteria:'</span>, num_items, <span class="st">'items and'</span>, num_days, <span class="st">'days.'</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Item logged</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    log_item_count <span class="op">=</span> df.groupby(identifier).agg(<span class="st">'count'</span>)[[<span class="st">'desc_text'</span>]].rename(columns <span class="op">=</span> {<span class="st">'desc_text'</span>: <span class="st">'Total Logged'</span>})</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Day counts</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    log_days_count <span class="op">=</span> df[[identifier, date_col]]<span class="op">\</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>        .drop_duplicates().groupby(identifier).agg(<span class="st">'count'</span>).rename(columns <span class="op">=</span> {date_col: <span class="st">'Day Count'</span>})</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    item_count_passed <span class="op">=</span> <span class="bu">set</span>(log_item_count[log_item_count[<span class="st">'Total Logged'</span>] <span class="op">&gt;=</span> num_items].index)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    day_count_passed <span class="op">=</span> <span class="bu">set</span>(log_days_count[log_days_count[<span class="st">'Day Count'</span>] <span class="op">&gt;=</span> num_days].index)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'  =&gt; # of public users pass the criteria:'</span>, end <span class="op">=</span> <span class="st">' '</span>)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">len</span>(item_count_passed <span class="op">&amp;</span> day_count_passed))</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    passed_participant_set <span class="op">=</span> item_count_passed <span class="op">&amp;</span> day_count_passed</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    df_usable <span class="op">=</span> df.loc[df.unique_code.<span class="bu">apply</span>(<span class="kw">lambda</span> c: c <span class="kw">in</span> passed_participant_set)]<span class="op">\</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>        .copy().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('  =&gt; Now returning the pd.DataFrame object with the head like the following.')</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># display(df_usable.head(5))</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_usable, <span class="bu">set</span>(df_usable.unique_code.unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> file_loader(<span class="st">'data/output/public.pickle'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>filtering_usable_data(df,<span class="st">'unique_code'</span>,<span class="st">'date'</span>, <span class="dv">1000</span>, <span class="dv">14</span>)[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_baseline_and_intervention_usable_data(data_scource, identifier, date_col, baseline_num_items, baseline_num_days, intervention_num_items, intervention_num_days):</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Filter and create baseline_expanded and intervention groups based on data_scource pickle file. Expanded baseline dataset contains the first two weeks data and 13, 14 weeks data that pass the given criteria. Intervention dataset contains 13, 14 weeks data that pass the given criteria.</span><span class="ch">\n</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or pandas dataframe format</span><span class="ch">\n</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identifier (str): unique_id or ID, or name that identifies people.</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col (str): column name that contains date information from the df dataframe.</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - baseline_num_items (int): number of items to be used as cut-off for baseline group. </span><span class="ch">\n</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - baseline_num_days (int): number of days to be used as cut-off for baseline group. </span><span class="ch">\n</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - intervention_num_items (int): number of items to be used as cut-off for intervention group.</span><span class="ch">\n</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - intervention_num_days (int): number of days to be used as cut-off for intervention group. </span><span class="ch">\n</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - a list in which index 0 is the baseline expanded dataframe and 1 is the intervention dataframe.</span><span class="ch">\n</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co">            - week_from_start</span><span class="ch">\n</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">            - desc_text</span><span class="ch">\n</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    public_all <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create baseline data</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    df_public_baseline <span class="op">=</span> public_all.query(<span class="st">'week_from_start &lt;= 2'</span>)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    df_public_baseline_usable, public_baseline_usable_id_set <span class="op">=</span> <span class="op">\</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    filtering_usable_data(df_public_baseline,identifier, date_col, num_items <span class="op">=</span> baseline_num_items, num_days <span class="op">=</span> baseline_num_days)</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create intervention data</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>    df_public_intervention <span class="op">=</span> public_all.query(<span class="st">'week_from_start in [13, 14]'</span>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>    df_public_intervention_usable, public_intervention_usable_id_set <span class="op">=</span> <span class="op">\</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>    filtering_usable_data(df_public_intervention,identifier, date_col, num_items <span class="op">=</span> intervention_num_items, num_days <span class="op">=</span> intervention_num_days)</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create df that contains both baseline and intervention id_set that contains data for the first two weeks</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    expanded_baseline_usable_id_set <span class="op">=</span> <span class="bu">set</span>(<span class="bu">list</span>(public_baseline_usable_id_set) <span class="op">+</span> <span class="bu">list</span>(public_intervention_usable_id_set))</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    df_public_basline_usable_expanded <span class="op">=</span> public_all.loc[public_all.<span class="bu">apply</span>(<span class="kw">lambda</span> s: s.week_from_start <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">\</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>                                                    <span class="kw">and</span> s.unique_code <span class="kw">in</span> expanded_baseline_usable_id_set, axis <span class="op">=</span> <span class="dv">1</span>)]</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [df_public_basline_usable_expanded, df_public_intervention_usable]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span> prepare_baseline_and_intervention_usable_data(<span class="st">'data/output/public.pickle'</span>,<span class="st">'unique_code'</span>,<span class="st">'date'</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">40</span>, <span class="dv">12</span>)[<span class="dv">0</span>]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-analysissummary" class="level3">
<h3 class="anchored" data-anchor-id="data-analysissummary">data analysis/summary</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> users_sorted_by_activity(data_scource, food_type <span class="op">=</span> [<span class="st">"f"</span>, <span class="st">"b"</span>, <span class="st">"m"</span>, <span class="st">"w"</span>]):</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This function returns a dataframe reports the number of good logging days for each user in the data_scource file. The default order is descending.</span><span class="ch">\n</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or pandas dataframe format.</span><span class="ch">\n</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - food_type (str): food types to filter in a list format. Default: ["f", "b", "m", "w"]. Available food types:</span><span class="ch">\n</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co">            1. 'w' : water </span><span class="ch">\n</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">            2. 'b' : beverage </span><span class="ch">\n</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">            3. 'f' : food </span><span class="ch">\n</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">            4. 'm' : medicine </span><span class="ch">\n</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - A dataframe contains the number of good logging days for each user.</span><span class="ch">\n</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co">            - unique_code</span><span class="ch">\n</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">            - date</span><span class="ch">\n</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    public_all <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter the dataframe so it only contains input food type</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    filtered_users <span class="op">=</span> public_all.query(<span class="st">'food_type in @food_type'</span>)</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    filtered_users[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(filtered_users,<span class="st">'unique_code'</span>,<span class="st">'date'</span>,<span class="st">'local_time'</span>)</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    public_top_users_day_counts <span class="op">=</span> pd.DataFrame(filtered_users.query(<span class="st">'in_good_logging_day == True'</span>)<span class="op">\</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>                            [[<span class="st">'date'</span>, <span class="st">'unique_code'</span>]].groupby(<span class="st">'unique_code'</span>)[<span class="st">'date'</span>].nunique())<span class="op">\</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>                            .sort_values(by <span class="op">=</span> <span class="st">'date'</span>, ascending <span class="op">=</span> <span class="va">False</span>).rename(columns <span class="op">=</span> {<span class="st">'date'</span>: <span class="st">'day_count'</span>})</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> public_top_users_day_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>users_sorted_by_activity(<span class="st">'data/output/public.pickle'</span>, [<span class="st">'f'</span>,<span class="st">'b'</span>]).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eating_intervals_percentile(data_scource, time_col, identifier):</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function calculates the .025, .05, .10, .125, .25, .5, .75, .875, .9, .95, .975 quantile of eating time and mid 95%, mid 90%, mid 80%, mid 75% and mid 50% duration for each user.</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the eating time.</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - A summary table with count, mean, std, min, quantiles and mid durations for all subjects from the data_scource file.</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.shape[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame(np.array([[np.nan]<span class="op">*</span><span class="dv">21</span>]), columns <span class="op">=</span> [<span class="st">'count'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'min'</span>, <span class="st">'2.5%'</span>, <span class="st">'5%'</span>, <span class="st">'10%'</span>, <span class="st">'12.5%'</span>, <span class="st">'25%'</span>,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>       <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'87.5%'</span>, <span class="st">'90%'</span>, <span class="st">'95%'</span>, <span class="st">'97.5%'</span>, <span class="st">'max'</span>, <span class="st">'duration mid 95%'</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>       <span class="st">'duration mid 90%'</span>, <span class="st">'duration mid 80%'</span>, <span class="st">'duration mid 75%'</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>       <span class="st">'duration mid 50%'</span>])</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    ptile <span class="op">=</span> df.groupby(identifier)[time_col].describe(percentiles<span class="op">=</span>[<span class="fl">.025</span>, <span class="fl">.05</span>, <span class="fl">.10</span>, <span class="fl">.125</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="fl">.875</span>, <span class="fl">.9</span>, <span class="fl">.95</span>, <span class="fl">.975</span>])</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> [<span class="st">'2.5%'</span>,<span class="st">'5%'</span>,<span class="st">'10%'</span>,<span class="st">'12.5%'</span>,<span class="st">'25%'</span>]</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    ul <span class="op">=</span> [<span class="st">'97.5%'</span>,<span class="st">'95%'</span>, <span class="st">'90%'</span>,<span class="st">'87.5%'</span>, <span class="st">'75%'</span>]</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    mp <span class="op">=</span> [<span class="st">'duration mid 95%'</span>, <span class="st">'duration mid 90%'</span>, <span class="st">'duration mid 80%'</span>, <span class="st">'duration mid 75%'</span>,<span class="st">'duration mid 50%'</span>]</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> low, upp, midp <span class="kw">in</span> <span class="bu">zip</span>(ll,ul,mp):</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>        ptile[midp] <span class="op">=</span> ptile[upp] <span class="op">-</span> ptile[low]</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ptile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>,<span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>,<span class="dv">4</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>eating_intervals_percentile(df, <span class="st">'float_time'</span>, <span class="st">'unique_code'</span>).iloc[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_cal_analysis_summary(data_scource, identifier, date_col, time_col,min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function takes the loggings in good logging days and calculate the 5%,10%,25%,50%,75%,90%,95% quantile of first_cal time for each user.</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - A summary table with 5%,10%,25%,50%,75%,90%,95% quantile of first_cal time for all subjects from the data_scource file.</span><span class="ch">\n</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings in a good logging day</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier, date_col, time_col, min_log_num, min_separation)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    first_cal_series <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">min</span>().groupby(identifier).quantile([<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>])</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    first_cal_df <span class="op">=</span> pd.DataFrame(first_cal_series)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>    all_rows <span class="op">=</span> []</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> first_cal_df.index:</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        tmp_dict <span class="op">=</span> <span class="bu">dict</span>(first_cal_series[index[<span class="dv">0</span>]])</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        tmp_dict[<span class="st">'id'</span>] <span class="op">=</span> index[<span class="dv">0</span>]</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        all_rows.append(tmp_dict)</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>    first_cal_summary_df <span class="op">=</span> pd.DataFrame(all_rows, columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>])<span class="op">\</span></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        .rename(columns <span class="op">=</span> {<span class="fl">0.05</span>: <span class="st">'5%'</span>, <span class="fl">0.1</span>: <span class="st">'10%'</span>, <span class="fl">0.25</span>: <span class="st">'25%'</span>, <span class="fl">0.5</span>: <span class="st">'50%'</span>, <span class="fl">0.75</span>: <span class="st">'75%'</span>, <span class="fl">0.9</span>: <span class="st">'90%'</span>, <span class="fl">0.95</span>: <span class="st">'95%'</span>})<span class="op">\</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>        .drop_duplicates().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> first_cal_summary_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>first_cal_analysis_summary(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>, <span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> last_cal_analysis_summary(data_scource, identifier, date_col, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function takes the loggings in good logging days and calculate the 5%,10%,25%,50%,75%,90%,95% quantile of last_cal time for each user.</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - A summary table with 5%,10%,25%,50%,75%,90%,95% quantile of last_cal time for all subjects from the data_scource file.</span><span class="ch">\n</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings that are in a good logging day</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier,date_col, time_col, min_log_num, min_separation)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    last_cal_series <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">max</span>().groupby(identifier).quantile([<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>])</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    last_cal_df <span class="op">=</span> pd.DataFrame(last_cal_series)</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    all_rows <span class="op">=</span> []</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> last_cal_df.index:</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>        tmp_dict <span class="op">=</span> <span class="bu">dict</span>(last_cal_series[index[<span class="dv">0</span>]])</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>        tmp_dict[<span class="st">'id'</span>] <span class="op">=</span> index[<span class="dv">0</span>]</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>        all_rows.append(tmp_dict)</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    last_cal_summary_df <span class="op">=</span> pd.DataFrame(all_rows, columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>])<span class="op">\</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>        .rename(columns <span class="op">=</span> {<span class="fl">0.05</span>: <span class="st">'5%'</span>, <span class="fl">0.1</span>: <span class="st">'10%'</span>, <span class="fl">0.25</span>: <span class="st">'25%'</span>, <span class="fl">0.5</span>: <span class="st">'50%'</span>, <span class="fl">0.75</span>: <span class="st">'75%'</span>, <span class="fl">0.9</span>: <span class="st">'90%'</span>, <span class="fl">0.95</span>: <span class="st">'95%'</span>})<span class="op">\</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>        .drop_duplicates().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> last_cal_summary_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>last_cal_analysis_summary(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>).head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_data(data_scource, identifier, float_time_col, date_col, min_log_num <span class="op">=</span> <span class="dv">2</span>, min_seperation <span class="op">=</span> <span class="dv">4</span>):</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function calculates num_days, num_total_items, num_f_n_b, num_medications, num_water, duration_mid_95, start_95, end_95, first_cal_avg, first_cal_std, last_cal_avg, last_cal_std, eating_win_avg, eating_win_std, adherent_count, first_cal variation (90%-10%), last_cal variation (90%-10%).</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - float_time_col(str) : the column that represents the eating time.</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span><span class="ch">\n</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - A summary table with count, mean, std, min, quantiles and mid durations for all subjects from the data_scource file.</span><span class="ch">\n</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#num_days</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    num_days <span class="op">=</span> df.groupby(identifier).date.nunique()</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#num_total_items</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    num_total_items <span class="op">=</span> df.groupby(identifier).count().iloc[:,<span class="dv">0</span>]</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#num_f_n_b</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>    num_f_n_b <span class="op">=</span> get_types(df, [<span class="st">'f'</span>,<span class="st">'b'</span>]).groupby(identifier).count().iloc[:,<span class="dv">0</span>]</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#num_medications</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>    num_medications <span class="op">=</span> get_types(df, [<span class="st">'m'</span>]).groupby(identifier).count().iloc[:,<span class="dv">0</span>]</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#num_water</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>    num_water <span class="op">=</span> get_types(df, [<span class="st">'w'</span>]).groupby(identifier).count().iloc[:,<span class="dv">0</span>]</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#duration_mid_95, start_95, end_95</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>    eating_intervals <span class="op">=</span> eating_intervals_percentile(df, float_time_col, identifier)[[<span class="st">'2.5%'</span>,<span class="st">'95%'</span>,<span class="st">'duration mid 95%'</span>]]</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#first_cal_avg</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>    first_cal_avg <span class="op">=</span> df.groupby([identifier, date_col])[float_time_col].<span class="bu">min</span>().groupby(identifier).mean()</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#first_cal_std</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>    first_cal_std <span class="op">=</span> df.groupby([identifier, date_col])[float_time_col].<span class="bu">min</span>().groupby(identifier).std()</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">#last_cal_avg</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>    last_cal_avg <span class="op">=</span> df.groupby([identifier, date_col])[float_time_col].<span class="bu">max</span>().groupby(identifier).mean()</span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#last_cal_std</span></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>    last_cal_std <span class="op">=</span> df.groupby([identifier, date_col])[float_time_col].<span class="bu">max</span>().groupby(identifier).std()</span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#eating_win_avg</span></span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>    eating_win_avg <span class="op">=</span> last_cal_avg <span class="op">-</span> first_cal_avg</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#eating_win_std</span></span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a>    eating_win_std <span class="op">=</span> (df.groupby([identifier, date_col])[float_time_col].<span class="bu">max</span>()<span class="op">-</span></span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a>                          df.groupby([identifier, date_col])[float_time_col].<span class="bu">min</span>()).groupby(identifier).std()</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#good_logging_count</span></span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df,identifier,date_col, float_time_col, min_log_num<span class="op">=</span>min_log_num, min_seperation<span class="op">=</span>min_seperation)</span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a>    good_logging_count <span class="op">=</span> df.groupby(identifier)[<span class="st">'in_good_logging_day'</span>].<span class="bu">sum</span>()</span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#first_cal variation (90%-10%)</span></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>    first_cal_variability <span class="op">=</span> first_cal_analysis_summary(df,identifier,date_col,float_time_col).set_index(<span class="st">'id'</span>)</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> first_cal_variability.columns:</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="op">==</span> <span class="st">'id'</span> <span class="kw">or</span> col <span class="op">==</span> <span class="st">'50%'</span>:</span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a>        first_cal_variability[col] <span class="op">=</span> first_cal_variability[col] <span class="op">-</span> first_cal_variability[<span class="st">'50%'</span>]</span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a>    first_cal_ser <span class="op">=</span> first_cal_variability[<span class="st">'90%'</span>] <span class="op">-</span> first_cal_variability[<span class="st">'10%'</span>]</span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">#last_cal variation (90%-10%)</span></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a>    last_cal_variability <span class="op">=</span> last_cal_analysis_summary(df,identifier,date_col,float_time_col).set_index(<span class="st">'id'</span>)</span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> last_cal_variability.columns:</span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="op">==</span> <span class="st">'id'</span> <span class="kw">or</span> col <span class="op">==</span> <span class="st">'50%'</span>:</span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a>        last_cal_variability[col] <span class="op">=</span> last_cal_variability[col] <span class="op">-</span> last_cal_variability[<span class="st">'50%'</span>]</span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a>    last_cal_ser <span class="op">=</span> last_cal_variability[<span class="st">'90%'</span>] <span class="op">-</span> last_cal_variability[<span class="st">'10%'</span>]</span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-85"><a href="#cb70-85" aria-hidden="true" tabindex="-1"></a>    returned <span class="op">=</span> pd.concat([num_days, num_total_items, num_f_n_b, num_medications, num_water, first_cal_avg, first_cal_std, last_cal_avg, last_cal_std, eating_win_avg, eating_win_std, good_logging_count, first_cal_ser, last_cal_ser], axis<span class="op">=</span><span class="dv">1</span>).reset_index()</span>
<span id="cb70-86"><a href="#cb70-86" aria-hidden="true" tabindex="-1"></a>    returned.columns <span class="op">=</span> [identifier,<span class="st">'num_days'</span>, <span class="st">'num_total_items'</span>, <span class="st">'num_f_n_b'</span>, <span class="st">'num_medications'</span>, <span class="st">'num_water'</span>, <span class="st">'first_cal_avg'</span>, <span class="st">'first_cal_std'</span>, <span class="st">'last_cal_avg'</span>, <span class="st">'last_cal_std'</span>, <span class="st">'eating_win_avg'</span>, <span class="st">'eating_win_std'</span>, <span class="st">'good_logging_count'</span>, <span class="st">'first_cal variation (90</span><span class="sc">%-10%</span><span class="st">)'</span>, <span class="st">'last_cal variation (90</span><span class="sc">%-10%</span><span class="st">)'</span>]</span>
<span id="cb70-87"><a href="#cb70-87" aria-hidden="true" tabindex="-1"></a>    returned <span class="op">=</span> returned.merge(eating_intervals, on <span class="op">=</span> identifier, how<span class="op">=</span><span class="st">'left'</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb70-88"><a href="#cb70-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a>    returned[<span class="st">'num_medications'</span>] <span class="op">=</span> returned[<span class="st">'num_medications'</span>].astype(<span class="st">'int'</span>)</span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a>    returned[<span class="st">'num_water'</span>] <span class="op">=</span> returned[<span class="st">'num_water'</span>].astype(<span class="st">'int'</span>)</span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> returned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_public_data(<span class="st">'data/test_food_details.csv'</span>, <span class="st">'unique_code'</span>, <span class="st">'original_logtime'</span>, <span class="dv">4</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>summarize_data(df,<span class="st">'unique_code'</span>, <span class="st">'float_time'</span>, <span class="st">'date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_data_with_experiment_phases(food_data, ref_tbl, min_log_num<span class="op">=</span><span class="dv">2</span>, min_seperation<span class="op">=</span><span class="dv">5</span>, buffer_time<span class="op">=</span> <span class="st">'15 minutes'</span>, h<span class="op">=</span><span class="dv">4</span>,report_level<span class="op">=</span><span class="dv">2</span>, txt <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a comprehensive function that performs all of the functionalities needed.</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - food_data(panda df): food_logging data.</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - ref_tbl(panda df): table that contains window information and study phase information for each participant.</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num(counts): minimum number of loggings to qualify a day as a good logging day.</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours): minimum period of separation between earliest and latest loggings to qualify a day as a good logging day</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - buffer_time(time in string that can be passed into pd.Timedelta()): wiggle room for to be added/subtracted on the ends of windows.</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - h(hours): hours to be pushed back.</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - report_level(int): whether to print out the dates of no logging days, bad logging days, bad window days and non-adherent days for each participant. 0 - no report. 1 - report no logging days. 2 - report no logging days, bad logging days, bad window days and non adherent days.</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - txt(boolean): if True, a txt format report will be saved in the current directory named "treets_warning_dates.txt".</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Output:</span><span class="ch">\n</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - df : dataframe that has all the variables needed and has the same row number as the ref_tbl.</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirement:</span><span class="ch">\n</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co">        - food logging data is already read from all files in the directories into a dataframe, which will be passed in as the variable food_data.</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - Columns 'Start_Day', 'End_day', 'mCC_ID', 'Eating_Window_Start', 'Eating_Window_End' existed in the ref_tbl.</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Sidenote: </span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="co">        - For eating window without restriction(HABIT or TRE not in intervention period), Eating_Window_Start is 0:00, Eating_Window_End is 23:59.</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> food_data.copy()</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># preprocess to get the date and float_time column</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'original_logtime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'original_logtime'</span>])</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'date'</span>] <span class="op">=</span>  find_date(df, <span class="st">'original_logtime'</span>, h)</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'float_time'</span>] <span class="op">=</span>  find_float_time(df, <span class="st">'original_logtime'</span>, h)</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get study phase duration</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> find_phase_duration(ref_tbl)</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reset the index of ref_tbl to avoid issues during concatenation</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    ref_tbl <span class="op">=</span> ref_tbl.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop through each row and get 'caloric_entries', 'mean_daily_eating_window', 'std_daily_eating_window', 'eariliest_entry', 'logging_day_counts',</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and 'good_logging_days', 'good_window_days', 'outside_window_days' and 'adherent_days' and find missing dates</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>    matrix <span class="op">=</span> []</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>    missing_dates <span class="op">=</span> {}</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>    bad_dates_dic <span class="op">=</span> {}</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> ref_tbl.iterrows():</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>        id_ <span class="op">=</span> row[<span class="st">'mCC_ID'</span>]</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> []</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> df[df[<span class="st">'PID'</span>]<span class="op">==</span>id_]</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> temp_df[(temp_df[<span class="st">'date'</span>]<span class="op">&gt;=</span>row[<span class="st">'Start_Day'</span>]) <span class="op">&amp;</span> (temp_df[<span class="st">'date'</span>]<span class="op">&lt;=</span>row[<span class="st">'End_day'</span>])]</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># num of caloric entries</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>        rows.append(count_caloric_entries(temp_df))</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># num of medication</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>        rows.append(get_types(temp_df, [<span class="st">'m'</span>]).shape[<span class="dv">0</span>])</span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># num of water</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>        rows.append(get_types(temp_df, [<span class="st">'w'</span>]).shape[<span class="dv">0</span>])</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># first cal average</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>        rows.append(mean_first_cal(temp_df,<span class="st">'date'</span>, <span class="st">'float_time'</span>))</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">#first cal std</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>        rows.append(std_first_cal(temp_df, <span class="st">'date'</span>, <span class="st">'float_time'</span>))</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># last cal average</span></span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>        rows.append(mean_last_cal(temp_df,<span class="st">'date'</span>, <span class="st">'float_time'</span>))</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># last cal std</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>        rows.append(std_last_cal(temp_df, <span class="st">'date'</span>, <span class="st">'float_time'</span>))</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># mean eating window</span></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>        rows.append(mean_daily_eating_duration(temp_df,<span class="st">'date'</span>,<span class="st">'float_time'</span>))</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>        rows.append(std_daily_eating_duration(temp_df,<span class="st">'date'</span>,<span class="st">'float_time'</span>))</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>        rows.append(earliest_entry(temp_df, <span class="st">'date'</span>,<span class="st">'float_time'</span>))</span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>        rows.append(logging_day_counts(temp_df))</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a>        row_day_num, bad_dates <span class="op">=</span> good_lwa_day_counts(df[df[<span class="st">'PID'</span>]<span class="op">==</span>id_]</span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>                                           , window_start<span class="op">=</span>row[<span class="st">'Eating_Window_Start'</span>]</span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>                                           , window_end <span class="op">=</span> row[<span class="st">'Eating_Window_End'</span>]</span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>                                           , time_col <span class="op">=</span> <span class="st">'float_time'</span></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>                                           , min_log_num<span class="op">=</span>min_log_num</span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>                                           , min_seperation<span class="op">=</span>min_seperation</span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>                                           , buffer_time<span class="op">=</span> buffer_time</span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>                                           , start_date<span class="op">=</span>row[<span class="st">'Start_Day'</span>]</span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a>                                           , end_date<span class="op">=</span>row[<span class="st">'End_day'</span>]</span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>                                            , h<span class="op">=</span>h)</span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> row_day_num:</span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a>            rows.append(x)</span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>        bad_logging <span class="op">=</span> bad_dates[<span class="dv">0</span>]</span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>        bad_window <span class="op">=</span> bad_dates[<span class="dv">1</span>]</span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>        non_adherent <span class="op">=</span> bad_dates[<span class="dv">2</span>]</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'</span><span class="sc">{}</span><span class="st">_bad_logging'</span>.<span class="bu">format</span>(id_) <span class="kw">not</span> <span class="kw">in</span> bad_dates_dic:</span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_bad_logging'</span>.<span class="bu">format</span>(id_)]<span class="op">=</span>bad_logging</span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_bad_window'</span>.<span class="bu">format</span>(id_)]<span class="op">=</span>bad_window</span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_non_adherent'</span>.<span class="bu">format</span>(id_)]<span class="op">=</span>non_adherent</span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_bad_logging'</span>.<span class="bu">format</span>(id_)]<span class="op">+=</span>bad_logging</span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_bad_window'</span>.<span class="bu">format</span>(id_)]<span class="op">+=</span>bad_window</span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a>            bad_dates_dic[<span class="st">'</span><span class="sc">{}</span><span class="st">_non_adherent'</span>.<span class="bu">format</span>(id_)]<span class="op">+=</span>non_adherent</span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a>        matrix.append(rows)</span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a>        date_lst <span class="op">=</span> find_missing_logging_days(df[df[<span class="st">'PID'</span>]<span class="op">==</span>id_], row[<span class="st">'Start_Day'</span>],row[<span class="st">'End_day'</span>])</span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only consider when the result is not nan</span></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(date_lst, <span class="bu">list</span>)<span class="op">==</span><span class="va">True</span>:</span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> id_ <span class="kw">in</span> missing_dates:</span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>                missing_dates[id_] <span class="op">+=</span> date_lst</span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a>                missing_dates[id_] <span class="op">=</span> date_lst</span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a temp dataframe</span></span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> pd.DataFrame(matrix, columns <span class="op">=</span> [<span class="st">'caloric_entries_num'</span>,<span class="st">'medication_num'</span>, <span class="st">'water_num'</span>,<span class="st">'first_cal_avg'</span>,<span class="st">'first_cal_std'</span>,</span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">'last_cal_avg'</span>, <span class="st">'last_cal_std'</span>, <span class="st">'mean_daily_eating_window'</span>, <span class="st">'std_daily_eating_window'</span>, <span class="st">'earliest_entry'</span>, <span class="st">'logging_day_counts'</span>\</span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a>                                         ,<span class="st">'good_logging_days'</span>, <span class="st">'good_window_days'</span>, <span class="st">'outside_window_days'</span>, <span class="st">'adherent_days'</span>])</span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># concat these two tables</span></span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a>    returned <span class="op">=</span> pd.concat([ref_tbl, tmp], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop through each row and get 2.5%, 97.5%, duration mid 95% column</span></span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a>    column_025 <span class="op">=</span> []</span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a>    column_975 <span class="op">=</span> []</span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> ref_tbl.iterrows():</span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a>        id_ <span class="op">=</span> row[<span class="st">'mCC_ID'</span>]</span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> df[df[<span class="st">'PID'</span>]<span class="op">==</span>id_]</span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> temp_df[(temp_df[<span class="st">'date'</span>]<span class="op">&gt;=</span>row[<span class="st">'Start_Day'</span>]) <span class="op">&amp;</span> (temp_df[<span class="st">'date'</span>]<span class="op">&lt;=</span>row[<span class="st">'End_day'</span>])]</span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a>        series <span class="op">=</span> eating_intervals_percentile(temp_df, <span class="st">'float_time'</span>, <span class="st">'PID'</span>)</span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a>            column_025.append(series.iloc[<span class="dv">0</span>][<span class="st">'2.5%'</span>])</span>
<span id="cb72-125"><a href="#cb72-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb72-126"><a href="#cb72-126" aria-hidden="true" tabindex="-1"></a>            column_025.append(np.nan)</span>
<span id="cb72-127"><a href="#cb72-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb72-128"><a href="#cb72-128" aria-hidden="true" tabindex="-1"></a>            column_975.append(series.iloc[<span class="dv">0</span>][<span class="st">'97.5%'</span>])</span>
<span id="cb72-129"><a href="#cb72-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb72-130"><a href="#cb72-130" aria-hidden="true" tabindex="-1"></a>            column_975.append(np.nan)</span>
<span id="cb72-131"><a href="#cb72-131" aria-hidden="true" tabindex="-1"></a>    returned[<span class="st">'2.5%'</span>] <span class="op">=</span> column_025</span>
<span id="cb72-132"><a href="#cb72-132" aria-hidden="true" tabindex="-1"></a>    returned[<span class="st">'97.5%'</span>] <span class="op">=</span> column_975</span>
<span id="cb72-133"><a href="#cb72-133" aria-hidden="true" tabindex="-1"></a>    returned[<span class="st">'duration mid 95%'</span>] <span class="op">=</span> returned[<span class="st">'97.5%'</span>] <span class="op">-</span> returned[<span class="st">'2.5%'</span>]</span>
<span id="cb72-134"><a href="#cb72-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-135"><a href="#cb72-135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> convert_to_percentage(ser, col):</span>
<span id="cb72-136"><a href="#cb72-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isnull(ser[col]):</span>
<span id="cb72-137"><a href="#cb72-137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ser[col]</span>
<span id="cb72-138"><a href="#cb72-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb72-139"><a href="#cb72-139" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(ser[col]<span class="op">/</span>ser[<span class="st">'phase_duration'</span>].days <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="op">+</span> <span class="st">'%'</span></span>
<span id="cb72-140"><a href="#cb72-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-141"><a href="#cb72-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate percentage for </span></span>
<span id="cb72-142"><a href="#cb72-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> returned.columns:</span>
<span id="cb72-143"><a href="#cb72-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'logging_day_counts'</span>,<span class="st">'good_logging_days'</span>, <span class="st">'good_window_days'</span>, <span class="st">'outside_window_days'</span>, <span class="st">'adherent_days'</span>]:</span>
<span id="cb72-144"><a href="#cb72-144" aria-hidden="true" tabindex="-1"></a>            returned[<span class="st">'%_'</span><span class="op">+</span>x] <span class="op">=</span> returned.<span class="bu">apply</span>(convert_to_percentage, col <span class="op">=</span> x, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb72-145"><a href="#cb72-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-146"><a href="#cb72-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reorder the columns</span></span>
<span id="cb72-147"><a href="#cb72-147" aria-hidden="true" tabindex="-1"></a>    returned <span class="op">=</span> returned[[<span class="st">'mCC_ID'</span>, <span class="st">'Participant_Study_ID'</span>, <span class="st">'Study Phase'</span>,</span>
<span id="cb72-148"><a href="#cb72-148" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Intervention group (TRE or HABIT)'</span>, <span class="st">'Start_Day'</span>, <span class="st">'End_day'</span>,</span>
<span id="cb72-149"><a href="#cb72-149" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Eating_Window_Start'</span>,<span class="st">'Eating_Window_End'</span>, <span class="st">'phase_duration'</span>,</span>
<span id="cb72-150"><a href="#cb72-150" aria-hidden="true" tabindex="-1"></a>       <span class="st">'caloric_entries_num'</span>,<span class="st">'medication_num'</span>, <span class="st">'water_num'</span>,<span class="st">'first_cal_avg'</span>,</span>
<span id="cb72-151"><a href="#cb72-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">'first_cal_std'</span>,<span class="st">'last_cal_avg'</span>, <span class="st">'last_cal_std'</span>, </span>
<span id="cb72-152"><a href="#cb72-152" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_daily_eating_window'</span>, <span class="st">'std_daily_eating_window'</span>,</span>
<span id="cb72-153"><a href="#cb72-153" aria-hidden="true" tabindex="-1"></a>       <span class="st">'earliest_entry'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span>, <span class="st">'duration mid 95%'</span>,</span>
<span id="cb72-154"><a href="#cb72-154" aria-hidden="true" tabindex="-1"></a>       <span class="st">'logging_day_counts'</span>, <span class="st">'%_logging_day_counts'</span>, <span class="st">'good_logging_days'</span>,</span>
<span id="cb72-155"><a href="#cb72-155" aria-hidden="true" tabindex="-1"></a>        <span class="st">'%_good_logging_days'</span>,<span class="st">'good_window_days'</span>, <span class="st">'%_good_window_days'</span>, </span>
<span id="cb72-156"><a href="#cb72-156" aria-hidden="true" tabindex="-1"></a>        <span class="st">'outside_window_days'</span>,<span class="st">'%_outside_window_days'</span>, <span class="st">'adherent_days'</span>,</span>
<span id="cb72-157"><a href="#cb72-157" aria-hidden="true" tabindex="-1"></a>       <span class="st">'%_adherent_days'</span>]]    </span>
<span id="cb72-158"><a href="#cb72-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-159"><a href="#cb72-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> report_level <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb72-160"><a href="#cb72-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> returned</span>
<span id="cb72-161"><a href="#cb72-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-162"><a href="#cb72-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> txt:</span>
<span id="cb72-163"><a href="#cb72-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'treets_warning_dates.txt'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb72-164"><a href="#cb72-164" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print out missing dates with participant's id</span></span>
<span id="cb72-165"><a href="#cb72-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x <span class="kw">in</span> missing_dates:</span>
<span id="cb72-166"><a href="#cb72-166" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(missing_dates[x])<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb72-167"><a href="#cb72-167" aria-hidden="true" tabindex="-1"></a>                    f.write(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> didn't log any food items in the following day(s):</span><span class="ch">\n</span><span class="st">"</span>.<span class="bu">format</span>(x))</span>
<span id="cb72-168"><a href="#cb72-168" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> didn't log any food items in the following day(s):"</span>.<span class="bu">format</span>(x))</span>
<span id="cb72-169"><a href="#cb72-169" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> date <span class="kw">in</span> missing_dates[x]:</span>
<span id="cb72-170"><a href="#cb72-170" aria-hidden="true" tabindex="-1"></a>                        f.write(<span class="bu">str</span>(date)<span class="op">+</span><span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb72-171"><a href="#cb72-171" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(date)</span>
<span id="cb72-172"><a href="#cb72-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb72-173"><a href="#cb72-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> missing_dates:</span>
<span id="cb72-174"><a href="#cb72-174" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(missing_dates[x])<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb72-175"><a href="#cb72-175" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> didn't log any food items in the following day(s):"</span>.<span class="bu">format</span>(x))</span>
<span id="cb72-176"><a href="#cb72-176" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> date <span class="kw">in</span> missing_dates[x]:</span>
<span id="cb72-177"><a href="#cb72-177" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(date)</span>
<span id="cb72-178"><a href="#cb72-178" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb72-179"><a href="#cb72-179" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> report_level <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb72-180"><a href="#cb72-180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> returned</span>
<span id="cb72-181"><a href="#cb72-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-182"><a href="#cb72-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> txt:</span>
<span id="cb72-183"><a href="#cb72-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'treets_warning_dates.txt'</span>, <span class="st">'a'</span>) <span class="im">as</span> f:</span>
<span id="cb72-184"><a href="#cb72-184" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print out bad logging, bad window and non-adherent dates with participant's id</span></span>
<span id="cb72-185"><a href="#cb72-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x <span class="kw">in</span> bad_dates_dic:</span>
<span id="cb72-186"><a href="#cb72-186" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(bad_dates_dic[x])<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb72-187"><a href="#cb72-187" aria-hidden="true" tabindex="-1"></a>                    strings <span class="op">=</span> x.split(<span class="st">'_'</span>)</span>
<span id="cb72-188"><a href="#cb72-188" aria-hidden="true" tabindex="-1"></a>                    f.write(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> have </span><span class="sc">{}</span><span class="st"> day(s) in the following day(s):</span><span class="ch">\n</span><span class="st">"</span>.<span class="bu">format</span>(strings[<span class="dv">0</span>], strings[<span class="dv">1</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>strings[<span class="dv">2</span>]))</span>
<span id="cb72-189"><a href="#cb72-189" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> have </span><span class="sc">{}</span><span class="st"> day(s) in the following day(s):"</span>.<span class="bu">format</span>(strings[<span class="dv">0</span>], strings[<span class="dv">1</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>strings[<span class="dv">2</span>]))</span>
<span id="cb72-190"><a href="#cb72-190" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> date <span class="kw">in</span> bad_dates_dic[x]:</span>
<span id="cb72-191"><a href="#cb72-191" aria-hidden="true" tabindex="-1"></a>                        f.write(<span class="bu">str</span>(date)<span class="op">+</span><span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb72-192"><a href="#cb72-192" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(date)</span>
<span id="cb72-193"><a href="#cb72-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb72-194"><a href="#cb72-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> bad_dates_dic:</span>
<span id="cb72-195"><a href="#cb72-195" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(bad_dates_dic[x])<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb72-196"><a href="#cb72-196" aria-hidden="true" tabindex="-1"></a>                strings <span class="op">=</span> x.split(<span class="st">'_'</span>)</span>
<span id="cb72-197"><a href="#cb72-197" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Participant </span><span class="sc">{}</span><span class="st"> have </span><span class="sc">{}</span><span class="st"> day(s) in the following day(s):"</span>.<span class="bu">format</span>(strings[<span class="dv">0</span>], strings[<span class="dv">1</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>strings[<span class="dv">2</span>]))</span>
<span id="cb72-198"><a href="#cb72-198" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> date <span class="kw">in</span> bad_dates_dic[x]:</span>
<span id="cb72-199"><a href="#cb72-199" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(date)</span>
<span id="cb72-200"><a href="#cb72-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-201"><a href="#cb72-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> returned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> summarize_data_with_experiment_phases(pd.read_csv(<span class="st">'data/col_test_data/toy_data_2000.csv'</span>)<span class="op">\</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                      , pd.read_excel(<span class="st">'data/col_test_data/toy_data_17May2021.xlsx'</span>), report_level <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plots" class="level3">
<h3 class="anchored" data-anchor-id="plots">plots</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_cal_mean_with_error_bar(data_scource, identifier, date_col, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function takes the loggings in good logging days, calculates the means and standard deviations of first_cal time for each participant and represent the calculated data with a scatter plot where the x axis is participants and the y axis is hours in a day.</span><span class="ch">\n</span><span class="co"> </span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - None.</span><span class="ch">\n</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings that are in a good logging day</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier, date_col, time_col, min_log_num, min_separation)</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>    first_cal_series <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">min</span>()</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find means and stds for each person</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> first_cal_series.groupby(<span class="st">'unique_code'</span>).mean().to_frame().rename(columns<span class="op">=</span>{<span class="st">'local_time'</span>:<span class="st">'mean'</span>})</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    stds <span class="op">=</span> first_cal_series.groupby(<span class="st">'unique_code'</span>).std().fillna(<span class="dv">0</span>).to_frame().rename(columns<span class="op">=</span>{<span class="st">'local_time'</span>:<span class="st">'std'</span>})</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> means.shape[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"More than 50 people are present which might make the graph look messy"</span>)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.concat([means,stds], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    temp.sort_values(<span class="st">'mean'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot scatter plot with error bars</span></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>    plt.scatter(<span class="bu">range</span>(temp.shape[<span class="dv">0</span>]),temp[<span class="st">'mean'</span>])</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>    plt.errorbar(<span class="bu">range</span>(temp.shape[<span class="dv">0</span>]), temp[<span class="st">'mean'</span>], yerr<span class="op">=</span>temp[<span class="st">'std'</span>], fmt<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>    plt.xticks([])</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Hours in a day"</span>)</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'first_cal Time per Person in Ascending Order'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>first_cal_mean_with_error_bar(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> last_cal_mean_with_error_bar(data_scource, identifier, date_col, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function takes the loggings in good logging days, calculates the means and standard deviations of last_cal time for each participant and represent the calculated data with a scatter plot where the x axis is participants and the y axis is hours in a day.</span><span class="ch">\n</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - None.</span><span class="ch">\n</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings that are in a good logging day</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier, date_col, time_col, min_log_num, min_separation)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    last_cal_series <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">max</span>()</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find means and stds for each person</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> last_cal_series.groupby(<span class="st">'unique_code'</span>).mean().to_frame().rename(columns<span class="op">=</span>{<span class="st">'local_time'</span>:<span class="st">'mean'</span>})</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    stds <span class="op">=</span> last_cal_series.groupby(<span class="st">'unique_code'</span>).std().fillna(<span class="dv">0</span>).to_frame().rename(columns<span class="op">=</span>{<span class="st">'local_time'</span>:<span class="st">'std'</span>})</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> means.shape[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"More than 50 people are present which might make the graph look messy"</span>)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.concat([means,stds], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>    temp.sort_values(<span class="st">'mean'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot scatter plot with error bars</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>    plt.scatter(<span class="bu">range</span>(temp.shape[<span class="dv">0</span>]),temp[<span class="st">'mean'</span>])</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>    plt.errorbar(<span class="bu">range</span>(temp.shape[<span class="dv">0</span>]), temp[<span class="st">'mean'</span>], yerr<span class="op">=</span>temp[<span class="st">'std'</span>], fmt<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>    plt.xticks([])</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Hours in a day"</span>)</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'last_cal Time per Person in Ascending Order'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>last_cal_mean_with_error_bar(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_cal_analysis_variability_plot(data_scource,identifier, date_col, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function calculates the variability of loggings in good logging day by subtracting 5%,10%,25%,50%,75%,90%,95% quantile of first_cal time from the 50% first_cal time. It can also make a histogram that represents the 90%-10% interval for all subjects.</span><span class="ch">\n</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - plot(bool) : Whether generating a histogram for first_cal variability. Default = True.</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="co">        - A dataframe that contains 5%,10%,25%,50%,75%,90%,95% quantile of first_cal time minus 50% time for each subjects from the data_scource file.</span><span class="ch">\n</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings in a good logging day</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier, date_col, time_col, min_log_num, min_separation)</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>    first_cal_series <span class="op">=</span> df.groupby([<span class="st">'unique_code'</span>, <span class="st">'date'</span>])[<span class="st">'local_time'</span>].<span class="bu">min</span>().groupby(<span class="st">'unique_code'</span>).quantile([<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>])</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    first_cal_df <span class="op">=</span> pd.DataFrame(first_cal_series)</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>    all_rows <span class="op">=</span> []</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> first_cal_df.index:</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>        tmp_dict <span class="op">=</span> <span class="bu">dict</span>(first_cal_series[index[<span class="dv">0</span>]])</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>        tmp_dict[<span class="st">'id'</span>] <span class="op">=</span> index[<span class="dv">0</span>]</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>        all_rows.append(tmp_dict)</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>    first_cal_summary_df <span class="op">=</span> pd.DataFrame(all_rows, columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>])<span class="op">\</span></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>        .rename(columns <span class="op">=</span> {<span class="fl">0.05</span>: <span class="st">'5%'</span>, <span class="fl">0.1</span>: <span class="st">'10%'</span>, <span class="fl">0.25</span>: <span class="st">'25%'</span>, <span class="fl">0.5</span>: <span class="st">'50%'</span>, <span class="fl">0.75</span>: <span class="st">'75%'</span>, <span class="fl">0.9</span>: <span class="st">'90%'</span>, <span class="fl">0.95</span>: <span class="st">'95%'</span>})<span class="op">\</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>        .drop_duplicates().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>    first_cal_variability_df <span class="op">=</span> first_cal_summary_df.copy()</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> first_cal_variability_df.columns:</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="op">==</span> <span class="st">'id'</span> <span class="kw">or</span> col <span class="op">==</span> <span class="st">'50%'</span>:</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>        first_cal_variability_df[col] <span class="op">=</span> first_cal_variability_df[col] <span class="op">-</span> first_cal_variability_df[<span class="st">'50%'</span>]</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>    first_cal_variability_df[<span class="st">'50%'</span>] <span class="op">=</span> first_cal_variability_df[<span class="st">'50%'</span>] <span class="op">-</span> first_cal_variability_df[<span class="st">'50%'</span>]</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>    sns_plot <span class="op">=</span> sns.distplot( first_cal_variability_df[<span class="st">'90%'</span>] <span class="op">-</span> first_cal_variability_df[<span class="st">'10%'</span>] )</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Variation Distribution for first_cal (90% - 10%)'</span>, ylabel<span class="op">=</span><span class="st">'Kernel Density Estimation'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>first_cal_analysis_variability_plot(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> last_cal_analysis_variability_plot(data_scource, identifier, date_col, time_col, min_log_num<span class="op">=</span><span class="dv">2</span>, min_separation<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function calculates the variability of loggings in good logging day by subtracting 5%,10%,25%,50%,75%,90%,95% quantile of last_cal time from the 50% last_cal time and makes a histogram that represents the 90%-10% interval for all subjects.</span><span class="ch">\n</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_log_num (count,int): filtration criteria on the minimum number of loggings each day.</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co">        - min_seperation(hours,int): filtration criteria on the minimum separations between the earliest and latest loggings each day.</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - plot(bool) : Whether generating a histogram for first_cal variability. Default = True.</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span><span class="ch">\n</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># leave only the loggings that are in a good logging day</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'in_good_logging_day'</span>] <span class="op">=</span> in_good_logging_day(df, identifier,date_col, time_col, min_log_num, min_separation)</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'in_good_logging_day'</span>]<span class="op">==</span><span class="va">True</span>]</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    last_cal_series <span class="op">=</span> df.groupby([<span class="st">'unique_code'</span>, <span class="st">'date'</span>])[<span class="st">'local_time'</span>].<span class="bu">max</span>().groupby(<span class="st">'unique_code'</span>).quantile([<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>])</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>    last_cal_df <span class="op">=</span> pd.DataFrame(last_cal_series)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    all_rows <span class="op">=</span> []</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> last_cal_df.index:</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>        tmp_dict <span class="op">=</span> <span class="bu">dict</span>(last_cal_series[index[<span class="dv">0</span>]])</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>        tmp_dict[<span class="st">'id'</span>] <span class="op">=</span> index[<span class="dv">0</span>]</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>        all_rows.append(tmp_dict)</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    last_cal_summary_df <span class="op">=</span> pd.DataFrame(all_rows, columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>])<span class="op">\</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>        .rename(columns <span class="op">=</span> {<span class="fl">0.05</span>: <span class="st">'5%'</span>, <span class="fl">0.1</span>: <span class="st">'10%'</span>, <span class="fl">0.25</span>: <span class="st">'25%'</span>, <span class="fl">0.5</span>: <span class="st">'50%'</span>, <span class="fl">0.75</span>: <span class="st">'75%'</span>, <span class="fl">0.9</span>: <span class="st">'90%'</span>, <span class="fl">0.95</span>: <span class="st">'95%'</span>})<span class="op">\</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>        .drop_duplicates().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    last_cal_variability_df <span class="op">=</span> last_cal_summary_df.copy()</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> last_cal_variability_df.columns:</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="op">==</span> <span class="st">'id'</span> <span class="kw">or</span> col <span class="op">==</span> <span class="st">'50%'</span>:</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>        last_cal_variability_df[col] <span class="op">=</span> last_cal_variability_df[col] <span class="op">-</span> last_cal_variability_df[<span class="st">'50%'</span>]</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>    last_cal_variability_df[<span class="st">'50%'</span>] <span class="op">=</span> last_cal_variability_df[<span class="st">'50%'</span>] <span class="op">-</span> last_cal_variability_df[<span class="st">'50%'</span>]</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>    sns_plot <span class="op">=</span> sns.distplot( last_cal_variability_df[<span class="st">'90%'</span>] <span class="op">-</span> last_cal_variability_df[<span class="st">'10%'</span>] )</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Variation Distribution for last_cal (90% - 10%)'</span>, ylabel<span class="op">=</span><span class="st">'Kernel Density Estimation'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>last_cal_analysis_variability_plot(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_cal_avg_histplot(data_scource, identifier, date_col, time_col):</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function take the first caloric event (no water or med) and calculate average event's time for “each participant”.</span><span class="ch">\n</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.query(<span class="st">'food_type in ["f", "b"]'</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    first_cal_time <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">min</span>()</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    avg_first_cal_time <span class="op">=</span> first_cal_time.reset_index().groupby(identifier).mean()</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    sns.distplot(avg_first_cal_time[time_col], kde <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'First Meal Time - Averaged by Person'</span>, ylabel<span class="op">=</span><span class="st">'Frequency Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>first_cal_avg_histplot(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_cal_sample_distplot(data_scource, n, identifier, date_col, time_col):</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function plots the distplot for the first_cal time from n participants that will be randomly selected with replacement.</span><span class="ch">\n</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span><span class="ch">\n</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - n (int): the number of distplot in the output figure</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])]</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>    first_cal_by_person <span class="op">=</span> pd.DataFrame(df.groupby([identifier, date_col])<span class="op">\</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>                                       [time_col].<span class="bu">min</span>())</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Plotting distplots for the following users:'</span>)</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.random.choice(np.array(<span class="bu">list</span>(<span class="bu">set</span>(first_cal_by_person.index.droplevel(date_col)))), n):</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i)</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>        sns.distplot(first_cal_by_person[time_col].loc[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>first_cal_sample_distplot(<span class="st">'data/output/public_intervention_usable.pickle'</span>,<span class="dv">5</span>, <span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> last_cal_avg_histplot(data_scource, identifier, date_col, time_col):</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function take the last caloric event (no water or med) and calculate average event's time for “each participant”.</span><span class="ch">\n</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.query(<span class="st">'food_type in ["f", "b"]'</span>)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    first_cal_time <span class="op">=</span> df.groupby([identifier, date_col])[time_col].<span class="bu">max</span>()</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    avg_first_cal_time <span class="op">=</span> first_cal_time.reset_index().groupby(identifier).mean()</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>    sns.distplot(avg_first_cal_time[time_col], kde <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Last Meal Time - Averaged by Person'</span>, ylabel<span class="op">=</span><span class="st">'Frequency Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>last_cal_avg_histplot(<span class="st">'data/output/public_basline_usable_expanded.pickle'</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> last_cal_sample_distplot(data_scource, n, identifier, date_col, time_col):</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function plots the distplot for the last_cal time from n participants that will be randomly selected with replacement.</span><span class="ch">\n</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - n (int): the number of participants that will be randomly selected in the output figure</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="co">        - food_type</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'food_type'</span>].isin([<span class="st">'f'</span>,<span class="st">'b'</span>])]</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>    last_cal_by_person <span class="op">=</span> pd.DataFrame(df.groupby([identifier, date_col])<span class="op">\</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>                                       [time_col].<span class="bu">max</span>())</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Plotting distplots for the following users:'</span>)</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.random.choice(np.array(<span class="bu">list</span>(<span class="bu">set</span>(last_cal_by_person.index.droplevel(date_col)))), n):</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i)</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>        sns.distplot(last_cal_by_person[time_col].loc[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>last_cal_sample_distplot(<span class="st">'data/output/public_intervention_usable.pickle'</span>,<span class="dv">5</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> swarmplot(data_scource, max_loggings, identifier, date_col, time_col):</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span><span class="ch">\n</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">       This function plots the swarmplot the participants from the data_scource file.</span><span class="ch">\n</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Input:</span><span class="ch">\n</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">        - data_scource (str, pandas df): input path, file in pickle, csv or panda dataframe format.</span><span class="ch">\n</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co">        - max_loggings (int): the max number of loggings to be plotted for each participants, loggings will be randomly selected.</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co">        - identitfier(str) : participants' unique identifier such as id, name, etc.</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">        - date_col(str) : the column that represents the dates.</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co">        - time_col(str) : the column that represents the float time.</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span><span class="ch">\n</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co">        - None</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Requirements:</span><span class="ch">\n</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="co">        data_scource file must have the following columns:</span><span class="ch">\n</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="co">            - food_type</span><span class="ch">\n</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Optional functions to use to have proper inputs:</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_date() for date_col</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - find_float_time() for time_col</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> file_loader(data_scource)</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> subsamp_by_cond(alldat):</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>        alld <span class="op">=</span> []</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> apart <span class="kw">in</span> alldat[identifier].unique():</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>            dat <span class="op">=</span> alldat[alldat[identifier]<span class="op">==</span>apart]</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>            f_n_b <span class="op">=</span> dat.query(<span class="st">'food_type in ["f", "b"]'</span>)</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> <span class="bu">min</span>([f_n_b.shape[<span class="dv">0</span>], max_loggings])</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>            sub <span class="op">=</span> f_n_b.sample(n <span class="op">=</span> n, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>            alld.append(sub)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.concat(alld)</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> subsamp_by_cond(df)</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">30</span>), dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>    ax.axvspan(<span class="fl">3.5</span>,<span class="dv">6</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span>[<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>]  )</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>    ax.axvspan(<span class="dv">18</span>,<span class="fl">28.5</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span>[<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>]  )</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.xlabel('Hour of day')</span></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>    plt.xticks([<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">12</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">24</span>,<span class="dv">28</span>],[<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">12</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">24</span>,<span class="dv">4</span>])</span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Food events for TRE group'</span>)</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.swarmplot(data <span class="op">=</span> sample, </span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>                  y <span class="op">=</span> identifier, </span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>                  x <span class="op">=</span> time_col, </span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>                  dodge <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>                  color <span class="op">=</span> sns.xkcd_rgb[<span class="st">'golden rod'</span>],</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(</span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>        facecolor <span class="op">=</span> <span class="st">'white'</span>, </span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">'Food events (F &amp; B)'</span>,</span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">'Participant'</span>,</span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>        xlabel <span class="op">=</span> <span class="st">'Local time of consumption'</span></span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>swarmplot(<span class="st">'data/output/public.pickle'</span>, <span class="dv">20</span>,<span class="st">'unique_code'</span>, <span class="st">'date'</span>, <span class="st">'local_time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FoodParser():</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">    A class that reads in food loggings from the app. Used as helper function for the function clean_loggings().</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.__version__ = '0.1.9'</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.wnl <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.spell = SpellChecker()</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">################# Read in Annotations #################</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_parser_keys_df(<span class="va">self</span>, parser_keys_df):</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        parser_keys_df <span class="op">=</span> parser_keys_df.query(<span class="st">'food_type in ["f", "b", "m", "w", "modifier", "general", "stopword", "selfcare"]'</span>).reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. all_gram_sets</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>        all_gram_set <span class="op">=</span> []</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>            all_gram_set.append(<span class="bu">set</span>(parser_keys_df.query(<span class="st">'gram_type == '</span> <span class="op">+</span> <span class="bu">str</span>(i)).gram_key.values))</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. food_type_dict</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        food_type_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(parser_keys_df.gram_key.values, parser_keys_df.food_type.values))</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. food2tag</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> find_all_tags(s):</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>            tags <span class="op">=</span> []</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(s[<span class="st">'tag'</span> <span class="op">+</span> <span class="bu">str</span>(i)], <span class="bu">str</span>) <span class="kw">and</span> np.isnan(s[<span class="st">'tag'</span> <span class="op">+</span> <span class="bu">str</span>(i)]):</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>                tags.append(s[<span class="st">'tag'</span> <span class="op">+</span> <span class="bu">str</span>(i)])</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> tags</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>        food2tags <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(parser_keys_df.gram_key.values, parser_keys_df.<span class="bu">apply</span>(find_all_tags, axis <span class="op">=</span> <span class="dv">1</span>)))</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> all_gram_set, food_type_dict, food2tags</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialization(<span class="va">self</span>):</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. read in manually annotated file and bind it to the object</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pypi version</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a><span class="co">#         parser_keys_df = pd.read_csv(pkg_resources.resource_stream(__name__, "/data/parser_keys.csv"))</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a><span class="co">#         all_gram_set, food_type_dict, food2tags = self.process_parser_keys_df(parser_keys_df)</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a><span class="co">#         correction_dic = pickle.load(pkg_resources.resource_stream(__name__, "/data/correction_dic.pickle"))</span></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a><span class="co">#         # testing version</span></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>        parser_keys_df <span class="op">=</span> pd.read_csv(<span class="st">"data/parser_keys.csv"</span>)</span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>        all_gram_set, food_type_dict, food2tags <span class="op">=</span> <span class="va">self</span>.process_parser_keys_df(parser_keys_df)</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>        correction_dic <span class="op">=</span> file_loader(<span class="st">"data/correction_dic.pickle"</span>)</span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_gram_set <span class="op">=</span> all_gram_set</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.food_type_dict <span class="op">=</span> food_type_dict</span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.correction_dic <span class="op">=</span> correction_dic</span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tmp_correction <span class="op">=</span> {}</span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Load common stop words and bind it to the object</span></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a>        stop_words <span class="op">=</span> stopwords.words(<span class="st">'english'</span>)</span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Updated by Katherine August 23rd 2020</span></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>        stop_words.remove(<span class="st">'out'</span>) <span class="co"># since pre work out is a valid beverage name</span></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>        stop_words.remove(<span class="st">'no'</span>)</span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>        stop_words.remove(<span class="st">'not'</span>)</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stop_words <span class="op">=</span> stop_words</span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">########## Pre-Processing ##########</span></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function for removing numbers</span></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_numbers(<span class="va">self</span>, text):</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>        clean_text <span class="op">=</span> text</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>        clean_text <span class="op">=</span> re.sub(<span class="st">'[0-9]+\.[0-9]+'</span>, <span class="st">''</span> , clean_text)</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>        clean_text <span class="op">=</span> re.sub(<span class="st">'[0-9]+'</span>, <span class="st">''</span> , clean_text)</span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>        clean_text <span class="op">=</span> re.sub(<span class="st">'\s\s+'</span>, <span class="st">' '</span>, clean_text)</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> clean_text</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function for removing punctuation</span></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> drop_punc(<span class="va">self</span>, text):</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>        clean_text <span class="op">=</span> re.sub(<span class="st">'[</span><span class="sc">%s</span><span class="st">]'</span> <span class="op">%</span> re.escape(string.punctuation), <span class="st">' '</span>, text)</span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> clean_text</span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove normal stopwords</span></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> remove_stop(<span class="va">self</span>, my_text):</span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a>        text_list <span class="op">=</span> my_text.split()</span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span>.join([word <span class="cf">for</span> word <span class="kw">in</span> text_list <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.stop_words])</span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pre_processing(<span class="va">self</span>, text):</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> text.lower()</span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.remove_stop(<span class="va">self</span>.handle_numbers(<span class="va">self</span>.drop_punc(text))).strip()</span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">########## Handle Format ##########</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_front_mixing(<span class="va">self</span>, sent, front_mixed_tokens):</span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>        cleaned_tokens <span class="op">=</span> []</span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> sent.split():</span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> t <span class="kw">in</span> front_mixed_tokens:</span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> re.findall(<span class="st">'\d+[xX]*'</span>, t)[<span class="dv">0</span>]</span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t_0 <span class="kw">in</span> t.replace(number, number <span class="op">+</span> <span class="st">' '</span>).split():</span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a>                    cleaned_tokens.append(t_0)</span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a>                cleaned_tokens.append(t)</span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span>.join(cleaned_tokens)</span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_x2(<span class="va">self</span>, sent, times_x_tokens):</span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> times_x_tokens:</span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>            sent <span class="op">=</span> sent.replace(t, <span class="st">' '</span> <span class="op">+</span> t.replace(<span class="st">' '</span>, <span class="st">''</span>).lower() <span class="op">+</span> <span class="st">' '</span>)</span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span>.join([s <span class="cf">for</span> s <span class="kw">in</span> sent.split() <span class="cf">if</span> s <span class="op">!=</span> <span class="st">''</span>]).strip()</span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_format(<span class="va">self</span>, sent):</span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a>        return_sent <span class="op">=</span> sent</span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Problem 1: 'front mixing'</span></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a>        front_mixed_tokens <span class="op">=</span> re.findall(<span class="st">'\d+[^\sxX]+'</span>, sent)</span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(front_mixed_tokens) <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>            return_sent <span class="op">=</span> <span class="va">self</span>.handle_front_mixing(return_sent, front_mixed_tokens)</span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Problem 2: 'x2', 'X2', 'X 2', 'x 2'</span></span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>        times_x_tokens <span class="op">=</span> re.findall(<span class="st">'[xX]\s*?\d'</span>, return_sent)</span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(times_x_tokens) <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a>            return_sent <span class="op">=</span> <span class="va">self</span>.handle_x2(return_sent, times_x_tokens)</span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> return_sent</span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a>    <span class="co">########## Handle Typo ##########</span></span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fix_spelling(<span class="va">self</span>, entry, speller_check <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> token <span class="kw">in</span> entry.split():</span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check known corrections</span></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> token <span class="kw">in</span> <span class="va">self</span>.correction_dic.keys():</span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a>                token_alt <span class="op">=</span> <span class="va">self</span>.wnl.lemmatize(<span class="va">self</span>.correction_dic[token])</span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> speller_check <span class="kw">and</span> token <span class="kw">in</span> <span class="va">self</span>.tmp_correction.keys():</span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a>                    token_alt <span class="op">=</span> <span class="va">self</span>.wnl.lemmatize(<span class="va">self</span>.tmp_correction[token])</span>
<span id="cb92-131"><a href="#cb92-131" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> speller_check <span class="kw">and</span> token <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.food_type_dict.keys():</span>
<span id="cb92-132"><a href="#cb92-132" aria-hidden="true" tabindex="-1"></a>                    token_alt <span class="op">=</span> <span class="va">self</span>.wnl.lemmatize(token)</span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.tmp_correction[token] <span class="op">=</span> token_alt</span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a>                    token_alt <span class="op">=</span> <span class="va">self</span>.wnl.lemmatize(token)</span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a>            result.append(token_alt)</span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span>.join(result)</span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">########### Combine all cleaning ##########</span></span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_all_cleaning(<span class="va">self</span>, entry):</span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">=</span> <span class="va">self</span>.pre_processing(entry)</span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">=</span> <span class="va">self</span>.clean_format(cleaned)</span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">=</span> <span class="va">self</span>.fix_spelling(cleaned)</span>
<span id="cb92-144"><a href="#cb92-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cleaned</span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a>    <span class="co">########## Handle Gram Matching ##########</span></span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_single_gram(<span class="va">self</span>, gram_length, gram_set, gram_lst, sentence_tag):</span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a>        food_lst <span class="op">=</span> []</span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(gram_length, gram_lst, sentence_tag)</span></span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gram_lst)):</span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> gram_length <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a>                curr_word <span class="op">=</span> <span class="st">' '</span>.join(gram_lst[i])</span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a>                curr_word <span class="op">=</span> gram_lst[i]</span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> curr_word <span class="kw">in</span> gram_set <span class="kw">and</span> <span class="bu">sum</span>([t <span class="op">!=</span> <span class="st">'Unknown'</span> <span class="cf">for</span> t <span class="kw">in</span> sentence_tag[i: i<span class="op">+</span>gram_length]]) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a>                sentence_tag[i: i<span class="op">+</span>gram_length] <span class="op">=</span> <span class="bu">str</span>(gram_length)</span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a>                food_lst.append(curr_word)</span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> food_lst</span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_single_entry(<span class="va">self</span>, entry, return_sentence_tag <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pre-processing and Cleaning</span></span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">=</span> <span class="va">self</span>.handle_all_cleaning(entry)</span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create tokens and n-grams</span></span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a>        tokens <span class="op">=</span> nltk.word_tokenize(cleaned)</span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a>        bigram <span class="op">=</span> <span class="bu">list</span>(nltk.ngrams(tokens, <span class="dv">2</span>)) <span class="cf">if</span> <span class="bu">len</span>(tokens) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a>        trigram <span class="op">=</span> <span class="bu">list</span>(nltk.ngrams(tokens, <span class="dv">3</span>)) <span class="cf">if</span> <span class="bu">len</span>(tokens) <span class="op">&gt;</span> <span class="dv">2</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a>        quadgram <span class="op">=</span> <span class="bu">list</span>(nltk.ngrams(tokens, <span class="dv">4</span>)) <span class="cf">if</span> <span class="bu">len</span>(tokens) <span class="op">&gt;</span> <span class="dv">3</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a>        pentagram <span class="op">=</span> <span class="bu">list</span>(nltk.ngrams(tokens, <span class="dv">5</span>)) <span class="cf">if</span> <span class="bu">len</span>(tokens) <span class="op">&gt;</span> <span class="dv">4</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a>        all_gram_lst <span class="op">=</span> [tokens, bigram, trigram, quadgram, pentagram]</span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-172"><a href="#cb92-172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create an array of tags</span></span>
<span id="cb92-173"><a href="#cb92-173" aria-hidden="true" tabindex="-1"></a>        sentence_tag <span class="op">=</span> np.array([<span class="st">'Unknown'</span>] <span class="op">*</span> <span class="bu">len</span>(tokens))</span>
<span id="cb92-174"><a href="#cb92-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-175"><a href="#cb92-175" aria-hidden="true" tabindex="-1"></a>        all_food <span class="op">=</span> []</span>
<span id="cb92-176"><a href="#cb92-176" aria-hidden="true" tabindex="-1"></a>        food_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb92-177"><a href="#cb92-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gram_length <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>]:</span>
<span id="cb92-178"><a href="#cb92-178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(tokens) <span class="op">&lt;</span> gram_length:</span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb92-180"><a href="#cb92-180" aria-hidden="true" tabindex="-1"></a>            tmp_food_lst <span class="op">=</span> <span class="va">self</span>.parse_single_gram(gram_length,</span>
<span id="cb92-181"><a href="#cb92-181" aria-hidden="true" tabindex="-1"></a>                                                <span class="va">self</span>.all_gram_set[gram_length <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a>                                                all_gram_lst[gram_length <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a>                                                sentence_tag)</span>
<span id="cb92-184"><a href="#cb92-184" aria-hidden="true" tabindex="-1"></a>            all_food <span class="op">+=</span> tmp_food_lst</span>
<span id="cb92-185"><a href="#cb92-185" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> return_sentence_tag:</span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> all_food, sentence_tag</span>
<span id="cb92-187"><a href="#cb92-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb92-188"><a href="#cb92-188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> all_food</span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-190"><a href="#cb92-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_food(<span class="va">self</span>, entry, return_sentence_tag <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb92-191"><a href="#cb92-191" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb92-192"><a href="#cb92-192" aria-hidden="true" tabindex="-1"></a>        unknown_tokens <span class="op">=</span> []</span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a>        num_unknown <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a>        num_token <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> w <span class="kw">in</span> entry.split(<span class="st">','</span>):</span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a>            all_food, sentence_tag <span class="op">=</span> <span class="va">self</span>.parse_single_entry(w, return_sentence_tag)</span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> all_food</span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(sentence_tag) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a>                num_unknown <span class="op">+=</span> <span class="bu">sum</span>(np.array(sentence_tag) <span class="op">==</span> <span class="st">'Unknown'</span>)</span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a>                num_token <span class="op">+=</span> <span class="bu">len</span>(sentence_tag)</span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a>                cleaned <span class="op">=</span> nltk.word_tokenize(<span class="va">self</span>.handle_all_cleaning(w))</span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Return un-catched tokens, groupped into sub-sections</span></span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a>                tmp_unknown <span class="op">=</span> <span class="st">''</span></span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sentence_tag)):</span>
<span id="cb92-206"><a href="#cb92-206" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sentence_tag[i] <span class="op">==</span> <span class="st">'Unknown'</span>:</span>
<span id="cb92-207"><a href="#cb92-207" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># unknown_tokens.append(cleaned[i])</span></span>
<span id="cb92-208"><a href="#cb92-208" aria-hidden="true" tabindex="-1"></a>                        tmp_unknown <span class="op">+=</span> (<span class="st">' '</span> <span class="op">+</span> cleaned[i])</span>
<span id="cb92-209"><a href="#cb92-209" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> i <span class="op">==</span> <span class="bu">len</span>(sentence_tag) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a>                            unknown_tokens.append(tmp_unknown)</span>
<span id="cb92-211"><a href="#cb92-211" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> tmp_unknown <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb92-212"><a href="#cb92-212" aria-hidden="true" tabindex="-1"></a>                        unknown_tokens.append(tmp_unknown)</span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a>                        tmp_unknown <span class="op">=</span> <span class="st">''</span></span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> return_sentence_tag:</span>
<span id="cb92-216"><a href="#cb92-216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result, num_token, num_unknown, unknown_tokens</span>
<span id="cb92-217"><a href="#cb92-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_food_type(<span class="va">self</span>, food):</span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> food <span class="kw">in</span> <span class="va">self</span>.food_type_dict.keys():</span>
<span id="cb92-222"><a href="#cb92-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.food_type_dict[food]</span>
<span id="cb92-223"><a href="#cb92-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'u'</span></span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a>    <span class="co">################# DataFrame Functions #################</span></span>
<span id="cb92-227"><a href="#cb92-227" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> expand_entries(<span class="va">self</span>, df):</span>
<span id="cb92-228"><a href="#cb92-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">'desc_text'</span> <span class="kw">in</span> df.columns, <span class="st">'[ERROR!] Required a column of "desc_text"!!'</span></span>
<span id="cb92-229"><a href="#cb92-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-230"><a href="#cb92-230" aria-hidden="true" tabindex="-1"></a>        all_entries <span class="op">=</span> []</span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(df.shape[<span class="dv">0</span>]):</span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a>            curr_row <span class="op">=</span> df.iloc[idx]</span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a>            logging <span class="op">=</span> curr_row.desc_text</span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a>            tmp_dict <span class="op">=</span> <span class="bu">dict</span>(curr_row)</span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">','</span> <span class="kw">in</span> logging:</span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> logging.split(<span class="st">','</span>):</span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a>                    tmp_dict <span class="op">=</span> tmp_dict.copy()</span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a>                    tmp_dict[<span class="st">'desc_text'</span>] <span class="op">=</span> entry</span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a>                    all_entries.append(tmp_dict)</span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a>                tmp_dict[<span class="st">'desc_text'</span>] <span class="op">=</span> logging</span>
<span id="cb92-242"><a href="#cb92-242" aria-hidden="true" tabindex="-1"></a>                all_entries.append(tmp_dict)</span>
<span id="cb92-243"><a href="#cb92-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame(all_entries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>